import asyncio
import logging
import random
import datetime
from aiogram import Bot, Dispatcher, types
from aiogram.types import Message
from aiogram.filters import CommandStart

# –¢–≤–æ–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
TOKEN = "8019699528:AAE1LebzllSYMZxoX8X3-oEvrc8xfz9i6zQ"

# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.basicConfig(level=logging.INFO)

# –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç—ã –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=TOKEN)
dp = Dispatcher()

# –°–ø–∏—Å–æ–∫ —Ñ—Ä–∞–∑ —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ —Å–º–∞–π–ª–∏–∫–∞–º–∏
responses = [
    "–ï—â–µ 1 –∏ —è —Å—Ç–∞–Ω—Ü—É—é –¥–ª—è —Ç–µ–±—è —Ç–∞–Ω–µ—Ü –º–∞–ª–µ–Ω—å–∫–∏—Ö —É—Ç—è—Ç üê§",
    "–û –¥–∞–≤–∞–π –µ—â–µ –ª–∏–¥–æ–∫, –∏ —è –ø—Ä–∏–Ω–µ—Å—É —Ç–µ–±–µ –∫–æ—Ñ–µ –≤ –ø–æ—Å—Ç–µ–ª—å, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–æ—á–Ω–æ üòÇ",
    "–û–ì–û–ù–¨ üî• ",
    "üî•üî•üî•",
    "–¢–∏–≥—Ä–∞ üêÖ ",
    "–¢–∞–Ω—Ü—É—é –¥–ª—è —Ç–µ–±—è –¥–∂–∏–≥—É-–¥—Ä—ã–≥—É üòè ",
    "–ë–æ–º–±–∞üí£ ",
    "–ú–æ–∂–µ—à—å –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—à—åüíâ ",
    "–ó–∞—á–µ—Ç üòé ",
    "–•—É—Ö, –Ω—É —Ö–æ—Ç—å 1 –µ—Å—Ç—å ü§• ",
    "–ú–æ—â–Ω–æ ü§© ",
    "–õ–µ–≥–µ–Ω–¥–∞ ‚ú®",
    "–û, –∑–∞—à–∏–±–∏—Å—åüòç ",
    "–†–∞–∫–µ—Ç–∞üöÄ‚Äç",
    "–í —Ç–æ–º –∂–µ –¥—É—Ö–µ –¥–æ 15 –ª–∏–¥–æ–≤üí∞ ",
    "–≠—Ç–æ –ø–æ –Ω–∞—à–µ–º—É, –≤—Å–µ –±–µ—Ä–µ–º –ø—Ä–∏–º–µ—Ä –∏ –¥–µ–ª–∞–µ–º —Ç–∞–∫ –∂–µ ‚ù§Ô∏è‚Äç",
    "–õ–æ—è–ª—å–Ω–∞—è –ø–æ–ø–∞–ª–∞—Å—å üëÄ",
    "–£—Ä–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞! ‚ù§Ô∏è‚Äç",
    "–°–¥–µ–ª–∞—é –Ω–∞ –ø–µ—Ä–µ–∫—É—Ä–µ –º–∞—Å—Å–∞–∂ –ø—è—Ç–æ–∫ ü§ù ",
    "–ï—â–µ –æ–¥–∏–Ω –∏ –∏–¥–µ–º —Å —Ç–æ–±–æ–π –≤–µ—á–µ—Ä–æ–º –Ω–∞ —Å–≤–∏–¥–∞–Ω–∏–µ üíç",
    "–ï—â–µ +1?‚Äçüò≥",
    "–£–º–Ω–∏—á–∫–∞ –º–æ—è üòò",
    "–ß–∏—Å—Ç–æ –ø–æ –∫—Ä–∞—Å–æ—Ç–µ! –æ–±–Ω–∏–º–∞—é, —Ü–µ–ª—É—é, –∂–º—É —Ä—É–∫—Éüòç!"
]

# –í–∞–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
important_message = """‚ÄºÔ∏è–§–∏—Ç–æ–Ω–æ—Ä–º–∞–ª –∏ —Å–≤–∞–º–ø–≥–µ–ª—å –º–æ–∂–Ω–æ –ø—Ä–æ–¥–∞–≤–∞—Ç—å ‚ÄºÔ∏è

3 –æ—Ñ—Ñ–µ—Ä–∞ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –∫—É—Ä—å–µ—Ä–∞ 

‚úÖ–í–∞–ª—å–≥–æ—Ç–æ–Ω (–∫–æ—Å—Ç–æ—á–∫–∞ –Ω–∞ –Ω–æ–≥–µ)
‚úÖ–í–µ–Ω–æ–ª–∏–¥ (–≤–∞—Ä–∏–∫–æ–∑)
‚úÖ–ú–µ–Ω —Å–∞–π–∑ (–ø–æ—Ç–µ–Ω—Ü–∏—è)"""

# –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º–æ–µ –≤ 10:00 —É—Ç—Ä–∞
morning_message = """‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è
–ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø - 20 –ú–ò–ù –í –î–ï–ù–¨
–î–û–ó–ê–ü–û–õ–ù–ï–ù–ò–ï - –£–ß–ò–¢–´–í–ê–Ø –ö–£–†–¨–ï–†–ê 6 –ú–ò–ù –ù–ê –ü–†–ò–ù–Ø–¢–´–ô –õ–ò–î
–û–ë–£–ß–ï–ù–ò–ï - –¢–û–õ–¨–ö–û –ü–û –ú–û–ï–ú–£ –ù–ê–ó–ù–ê–ß–ï–ù–ò–Æ
–õ–ò–ß–ù–´–ô –ü–ï–†–ï–†–´–í - 1 –ß–ê–°
–ó–í–û–ù–Æ –í –†–£–ß - 15 –ú–ò–ù –í –î–ï–ù–¨
‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è

–í—Å–µ –ø–µ—Ä–µ–ª–∏–º–∏—Ç—ã + 30 –º–∏–Ω—É—Ç –∏–ª–∏ —à—Ç—Ä–∞—Ñ 100 –≥—Ä–Ω üìå"""

# –ï–∂–µ—á–∞—Å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
hourly_message = """üçÑ –ì—Ä–∏–±–æ–∫ (—Å–≤–∞–º —ç–∫–∑–æ—Å—Ç–æ–ø) 
üç¨ –î–∏–∞–±–µ—Ç (–≥–ª—é–∫–æ–ª–∏–∫—Å)  
üêõ –ü–∞—Ä–∞–∑–∏—Ç—ã (–≥–µ—Ç–æ–∫—Å–∏–Ω, —Ç–æ–∫—Å–∏–ª–∏–¥) 
üë£ –í–∞–ª—å–≥—É—Å (–í–∞–ª—å–≥–æ—Ç–æ–Ω –∏ –ø—Ä–æ—á–∏–µ)  
üÖ±Ô∏è –í–∞—Ä–∏–∫–æ–∑ (–í–µ–Ω—Å–µ–π–≤ –í–µ–Ω–æ–ª–∏–¥) 
üëÇ –°–ª—É—Ö (–õ–æ—Ä–∞–±–∏–æ–Ω) 
üçÜ –£–≤–µ–ª–µ—á–µ–Ω–∏–µ (–¢–∏—Ç–∞–Ω –ê–∫—Ç–∏–≤) 

–í—Å—è –≥—É–º–∞–Ω–∏—Ç–∞—Ä–∫–∞ (sharkfarmfree) –∏ –≤–æ—Ç —ç—Ç–∏ –æ—Ñ—Ñ–µ—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ –§–ë (sharkfarm) –ø–æ —Å—Ç–∞—Ä—ã–º —Ü–µ–Ω–∞–º:
(4 —É–ø) 1990 –≥—Ä–Ω - (6 —É–ø) 2844 –≥—Ä–Ω"""

# –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
last_duplicate_time = 0

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–∂–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
async def duplicate_message():
    global last_duplicate_time
    while True:
        current_time = asyncio.get_event_loop().time()
        if current_time - last_duplicate_time >= 3600:  # 3600 —Å–µ–∫—É–Ω–¥ = 1 —á–∞—Å
            try:
                await bot.send_message(chat_id="-1001697395203", text=important_message)  
                last_duplicate_time = current_time
                logging.info("–í–∞–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–æ.")
            except Exception as e:
                logging.error(f"–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
        await asyncio.sleep(60)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ 10:00 —É—Ç—Ä–∞
async def daily_morning_reminder():
    while True:
        now = datetime.datetime.now()
        target_time = now.replace(hour=10, minute=0, second=0, microsecond=0)

        # –ï—Å–ª–∏ —É–∂–µ –ø–æ—Å–ª–µ 10:00, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ª—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
        if now > target_time:
            target_time += datetime.timedelta(days=1)

        wait_time = (target_time - now).total_seconds()
        logging.info(f"–ñ–¥–µ–º {wait_time / 3600:.2f} —á–∞—Å–æ–≤ –¥–æ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è...")
        await asyncio.sleep(wait_time)

        try:
            await bot.send_message(chat_id="-1001697395203", text=morning_message)
            logging.info("–£—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.")
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: {e}")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å
async def hourly_reminder():
    while True:
        await asyncio.sleep(3600)  # –ñ–¥–µ–º 1 —á–∞—Å
        try:
            await bot.send_message(chat_id="-1001697395203", text=hourly_message)
            logging.info("–ï–∂–µ—á–∞—Å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.")
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ—á–∞—Å–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: {e}")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
@dp.message()
async def respond(message: Message):
    if message.text in ["+1", "+2", "+1.5", "+1 –∫—É—Ä", "+1 –≥—É–º", "+1.5 –≥—É–º", "+1 –∫—Ä–æ—Å—Å"]:
        response = random.choice(responses)
        await message.reply(response)
        await message.react([types.ReactionTypeEmoji(emoji="‚ù§Ô∏è")])

@dp.message(CommandStart())
async def start_command(message: types.Message):
    await message.reply("–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂. –ö–∞–∫ –¥–µ–ª–∞?")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
async def main():
    asyncio.create_task(duplicate_message())       # –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    asyncio.create_task(daily_morning_reminder())  # –£—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ 10:00
    asyncio.create_task(hourly_reminder())         # –ï–∂–µ—á–∞—Å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
